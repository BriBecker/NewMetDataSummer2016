a
inSmbCohortQ <-
"SELECT CALENDAR_YEAR(convertTimezone(CreatedDate)) createYear,
CALENDAR_MONTH(convertTimezone(CreatedDate)) createMonth,
CALENDAR_YEAR(convertTimezone(CloseDate)) closeYear,
CALENDAR_MONTH(convertTimezone(CloseDate)) closeMonth,
SUM(Amount)
FROM Opportunity
GROUP BY CALENDAR_YEAR(convertTimezone(CreatedDate)),
CALENDAR_MONTH(convertTimezone(CreatedDate)),
CALENDAR_YEAR(convertTimezone(CloseDate),
CALENDAR_MONTH(convertTimezone(CloseDate)
ORDER BY CALENDAR_YEAR(convertTimezone(CreatedDate)),
CALENDAR_MONTH(convertTimezone(CreatedDate)),
CALENDAR_YEAR(convertTimezone(CloseDate),
CALENDAR_MONTH(convertTimezone(CloseDate) "
a <- rforcecom.query(sessionSF, inSmbCohortQ)
inSmbCohortQ <-
"SELECT CALENDAR_YEAR(convertTimezone(CreatedDate)) createYear,
CALENDAR_MONTH(convertTimezone(CreatedDate)) createMonth,
CALENDAR_YEAR(convertTimezone(CloseDate)) closeYear,
CALENDAR_MONTH(convertTimezone(CloseDate)) closeMonth,
SUM(Amount)
FROM Opportunity
GROUP BY CALENDAR_YEAR(convertTimezone(CreatedDate)),
CALENDAR_MONTH(convertTimezone(CreatedDate)),
CALENDAR_YEAR(convertTimezone(CloseDate)),
CALENDAR_MONTH(convertTimezone(CloseDate))
ORDER BY CALENDAR_YEAR(convertTimezone(CreatedDate)),
CALENDAR_MONTH(convertTimezone(CreatedDate)),
CALENDAR_YEAR(convertTimezone(CloseDate)),
CALENDAR_MONTH(convertTimezone(CloseDate))"
a <- rforcecom.query(sessionSF, inSmbCohortQ)
inSmbCohortQ <-
"SELECT CALENDAR_YEAR(convertTimezone(CreatedDate)) createYear,
CALENDAR_MONTH(convertTimezone(CreatedDate)) createMonth,
CALENDAR_YEAR(CloseDate) closeYear,
CALENDAR_MONTH(CloseDate) closeMonth,
SUM(Amount)
FROM Opportunity
GROUP BY CALENDAR_YEAR(convertTimezone(CreatedDate)),
CALENDAR_MONTH(convertTimezone(CreatedDate)),
CALENDAR_YEAR(CloseDate),
CALENDAR_MONTH(CloseDate)
ORDER BY CALENDAR_YEAR(convertTimezone(CreatedDate)),
CALENDAR_MONTH(convertTimezone(CreatedDate)),
CALENDAR_YEAR(CloseDate),
CALENDAR_MONTH(CloseDate)"
a <- rforcecom.query(sessionSF, inSmbCohortQ)
a
inSmbCohortQ <-
"SELECT CALENDAR_YEAR(convertTimezone(CreatedDate)) createYear,
CALENDAR_MONTH(convertTimezone(CreatedDate)) createMonth,
CALENDAR_YEAR(CloseDate) closeYear,
CALENDAR_MONTH(CloseDate) closeMonth,
SUM(Amount) amount
FROM Opportunity
GROUP BY CALENDAR_YEAR(convertTimezone(CreatedDate)),
CALENDAR_MONTH(convertTimezone(CreatedDate)),
CALENDAR_YEAR(CloseDate),
CALENDAR_MONTH(CloseDate)
ORDER BY CALENDAR_YEAR(convertTimezone(CreatedDate)),
CALENDAR_MONTH(convertTimezone(CreatedDate)),
CALENDAR_YEAR(CloseDate),
CALENDAR_MONTH(CloseDate)"
a <- rforcecom.query(sessionSF, inSmbCohortQ)
a
library(lubridate)
combMonthYear <- function(yearVec, monthVec) {
comb <- ifelse(monthVec < 10, paste0(yearVec,'-',0,monthVec),
paste0(yearVec,'-',monthVec))
return(comb)
}
a <- rforcecom.query(sessionSF, inSmbCohortQ) %>%
cleanPipePull()
source('helpers.R')
a <- rforcecom.query(sessionSF, inSmbCohortQ) %>%
cleanPipePull()
a
View(a)
dcast
library(dplyr)
dcast
library(tidyr)
dcast
cast
library(reshape2)
dcast
dcast(a, create ~ )
dcast(a, create ~ close)
View(dcast(a, create ~ close))
inSmbCohortQ <-
"SELECT CALENDAR_YEAR(convertTimezone(CreatedDate)) createYear,
CALENDAR_MONTH(convertTimezone(CreatedDate)) createMonth,
CALENDAR_YEAR(CloseDate) closeYear,
CALENDAR_MONTH(CloseDate) closeMonth,
SUM(Amount) amount
FROM Opportunity
WHERE
(NOT LeadSource IN ('Outbound Call', 'Internal List',
'mScore', 'SalesLoft', 'CL2014') OR
(NOT Original_Lead_Source__c IN ('Outbound Call', 'Internal List',
'mScore', 'SalesLoft', 'CL2014'))
GROUP BY CALENDAR_YEAR(convertTimezone(CreatedDate)),
CALENDAR_MONTH(convertTimezone(CreatedDate)),
CALENDAR_YEAR(CloseDate),
CALENDAR_MONTH(CloseDate)
ORDER BY CALENDAR_YEAR(convertTimezone(CreatedDate)),
CALENDAR_MONTH(convertTimezone(CreatedDate)),
CALENDAR_YEAR(CloseDate),
CALENDAR_MONTH(CloseDate)"
a <- rforcecom.query(sessionSF, inSmbCohortQ) %>%
cleanPipePull()
source('soqlQueries.R')
a <- rforcecom.query(sessionSF, inSmbCohortQ) %>%
cleanPipePull()
str(a)
a
View(dcast(a, create ~ close))
a <- rforcecom.query(sessionSF, inSmbCohortQ) %>%
cleanPipePull() %>%
dcast(create ~ close)
View(a)
source('soqlQueries.R')
a <- rforcecom.query(sessionSF, inSmbCloseQ) %>%
cleanPipePull() %>%
dcast(create ~ close)
sessionSF <- rforcecom.login(loginList[[1]], loginList[[2]],
loginList[[3]], loginList[[4]])
a <- rforcecom.query(sessionSF, inSmbCloseQ) %>%
cleanPipePull() %>%
dcast(create ~ close)
source('soqlQueries.R')
a <- rforcecom.query(sessionSF, inSmbCloseQ) %>%
cleanPipePull() %>%
dcast(create ~ close)
source('soqlQueries.R')
a <- rforcecom.query(sessionSF, inSmbCloseQ)
str(a)
a
a %>%cleanPipePull() %>%
dcast(create ~ close)
a <- rforcecom.query(sessionSF, inSmbCloseQ) %>%
cleanPipePull() %>%
dcast(create ~ close)
View(a)
source('soqlQueries.R')
a <- rforcecom.query(sessionSF, inSmbCloseQ) %>%
cleanPipePull() %>%
dcast(create ~ close)
source('soqlQueries.R')
a <- rforcecom.query(sessionSF, inSmbCloseQ) %>%
cleanPipePull() %>%
dcast(create ~ close)
source('soqlQueries.R')
a <- rforcecom.query(sessionSF, inSmbCloseQ) %>%
cleanPipePull() %>%
dcast(create ~ close)
source('soqlQueries.R')
a <- rforcecom.query(sessionSF, inSmbCloseQ) %>%
cleanPipePull() %>%
dcast(create ~ close)
View(a)
source('soqlQueries.R')
a <- rforcecom.query(sessionSF, inCloseQ) %>%
cleanPipePull() %>%
dcast(create ~ close)
source('soqlQueries.R')
a <- rforcecom.query(sessionSF, inCloseQ) %>%
cleanPipePull() %>%
dcast(create ~ close)
source('soqlQueries.R')
a <- rforcecom.query(sessionSF, inCloseQ) %>%
cleanPipePull() %>%
dcast(create ~ close)
View(a)
a
source('soqlQueries.R')
pipe <- rforcecom.query(sessionSF, inPipeQ)
source('soqlQueries.R')
pipe <- rforcecom.query(sessionSF, inPipeQ)
pipe
source('soqlQueries.R')
a <- rforcecom.query(sessionSF, inCloseQ) %>%
cleanPipePull() %>%
dcast(create ~ close)
View(a)
pipe
pipe <- rforcecom.query(sessionSF, inPipeQ) %>%
mutate(tcvDiff = newTcv.text - tcv.text)
pipe
pipe$create <- combMonthYear(pipe$createYear.text, pipe$createMonth.text)
pipe
str(pipe)
pipe$create <- paste0(pipe$create, '-01') %>% as.Date()
pipe
str(pipe)
ifelse(pipe$create >= 2016-02-01, 0 ,1)
ifelse(pipe$create >= '2016-02-01', 0 ,1)
pipe <- rforcecom.query(sessionSF, inPipeQ) %>%
cleanPipePull()
pipe <- rforcecom.query(sessionSF, inPipeQ)
df = pipe
df
df$create <- combMonthYear(df$createYear.text, df$createMonth.text)
df
df$tempDate <- paste0(df$create, '01') %>% as.Date()
df$tempDate <- paste0(df$create, '-01') %>% as.Date()
df
df$mixedTCV <- ifelse(df$tempDate >= '2016-02-01',
df$newTcv.text, df$tcv.text)
df %>%
select(create,
mixedTCV)
inClose<- rforcecom.query(sessionSF, inCloseQ) %>%
cleanClosePull() %>%
dcast(create ~ close)
source('helpers.R')
inClose<- rforcecom.query(sessionSF, inCloseQ) %>%
cleanClosePull() %>%
dcast(create ~ close)
inClose
inClose<- rforcecom.query(sessionSF, inCloseQ) %>%
cleanClosePull()
inClose
pipe
pipe <- rforcecom.query(sessionSF, inPipeQ) %>%
cleanPipePull()
pipe
startDate <- as.Date('2016-02-01')
startDate
str(startDate)
seq.Date(startDate)
seq.Date(startDate, Sys.Date())
seq.Date(startDate, Sys.Date(), by = 'month')
startDate <- as.Date('2014-02-01')
seqDate(startDate, Sys.Date(), by = 'month')
seq.Date(startDate, Sys.Date(), by = 'month')
seq.Date(startDate, Sys.Date(), by = 'month') %>%
length()
pipe
pipeDF
pipe
close
inClose
source('soqlQueries.R')
source('helpers.R')
inClose<- rforcecom.query(sessionSF, inCloseQ) %>%
cleanClosePull()
inClose
source('soqlQueries.R')
source('helpers.R')
inClose<- rforcecom.query(sessionSF, inCloseQ) %>%
cleanClosePull()
pipe <- rforcecom.query(sessionSF, inPipeQ) %>%
cleanPipePull()
inClose
pipe
pipe$create[1]
pipe$create[1] %>% genSeqMonthsSince()
pipe$create[1] %>% genSeqMonthsSince() %>% str()
rm(a)
a$create <- rep(pipe$create[1], calcNumMonthsSince(pipe$create[1]))
rep
?rep
rep(pipe$create[1])
rep(pipe$create[1], 5)
calcNumMonthsSince(pipe$create[1])
a$create <- rep(pipe$create[1], calcNumMonthsSince(pipe$create[1]))
a$create <- rep(pipe$create[1], times = calcNumMonthsSince(pipe$create[1]))
a$create <- rep(pipe$create[1], times = calcNumMonthsSince())
rep(pipe$create[1], calcNumMonthsSince())
a$create <- rep(pipe$create[1], calcNumMonthsSince())
a$[[1]] <- rep(pipe$create[1], calcNumMonthsSince())
a[[1]] <- rep(pipe$create[1], calcNumMonthsSince())
a[1] <- rep(pipe$create[1], calcNumMonthsSince())
a
rm(a)
a$create <- rep(pipe$create[1], calcNumMonthsSince())
df <- data.frame()
df$create <- rep(pipe$create[1], calcNumMonthsSince())
df <- data.frame(create = NULL, close = NULL)
df$create <- rep(pipe$create[1], calcNumMonthsSince())
df <- data.frame(create = rep(pipe$create[1]), calcNumMonthsSince()), close = NULL)
df <- data.frame(create = rep(pipe$create[1], calcNumMonthsSince()), close = NULL)
df <- data.frame(create = rep(pipe$create[1], calcNumMonthsSince()))
df
df$close <- 0
df
str(close)
str(inClose)
left_join(df, inClose)
inClose
str(inClose)
left_join(df, inClose, by = 'create')
semi_join(df, inClose, by = 'create')
semi_join(inClose, df, by = 'create')
left_join(df, inClose, by = 'create')
left_join(df, inClose %>% filter(create = '2014-02-1'), by = 'create')
left_join(df, inClose %>% filter(create == '2014-02-1'), by = 'create')
filtInClose <- filter(inClose, create == '2014-02-01')
filtInClose
left_join(df, filtInClose, by = 'create')
semi_join(filtInClose, df, by = 'create')
left_join(df, filtInClose, by = 'create')
filtInClose
df
left_join(df, filtInClose, by = 'create')
?left_join
inner_join(df, filtInClose, by = 'create')
left_join(df, filtInClose, by = 'create')
semi_join(df, filtInClose, by = 'create')
str(df$create)
class(df$create)
class(filtInClose$create)
semi_join(df, filtInClose, by = 'create')
left_join(df[, 1], filtInClose, by = 'create')
left_join(df[1, ], filtInClose, by = 'create')
semi_join(df, filtInClose, by = 'create')
semi_join(filtInClose, df, by = 'create')
df <- data.frame(create = rep(pipe$create[1], calcNumMonthsSince()),
close = genSeqMonthsSince(pipe$create[1]))
df
df$close <- 0
df
df <- data.frame(create = rep(pipe$create[1], calcNumMonthsSince()),
close = genSeqMonthsSince(pipe$create[1]))
df$amount <- 0
df
left_join(df, inClose, by = c('create', 'close'))
df <- data.frame(create = rep(pipe$create[1], calcNumMonthsSince()),
close = genSeqMonthsSince(pipe$create[1]))
left_join(df, inClose, by = c('create', 'close'))
pipe
df$pipeOpened <- pipe$mixedTCV[1]
df
left_join(df, inClose, by = c('create', 'close'))
df <- left_join(df, inClose, by = c('create', 'close'))
df
source('~/Google Drive/shiny-server2/cohort/helpers.R')
replace_NA <- function(DF, num = 0) {
DF[is.na(DF)] <- num
return(DF)
}
df <- mutate(df, closePercent = round(amount /pipeOpened, digit = 1))
df
df <- mutate(df, closePercent = round(amount /pipeOpened, digit = 3))
df
df <- mutate(df, closePercent = round(amount /pipeOpened, digit = 5))
df
df <- mutate(df, closePercent = amount / pipeOpened)
df
df <- df %>% replace_NA()
df
result <- data.frame(create = 0, close = 0, amount = 0, closePercent = 0)
result
rbind(result, df[-closePercent])
rbind(result, df[, -closePercent])
df
rbind(result, df$closePercent)
rbind(result, select(df, -closePercent))
select(df, -closePercent)
result <- data.frame(create = 0, close = 0, amount = 0,
pipeOpened = 0, closePercent = 0)
rbind(result, select(df, -closePercent))
result
select(df - closePercent)
select(df, - closePercent)
result <- data.frame(create = 0, close = 0,
pipeOpened = 0, closePercent = 0)
rbind(result, select(df, -closePercent))
result
select(df, - closePercent)
result <- data.frame(create = 0, close = 0,
pipeOpened = 0, amount = 0)
rbind(result, select(df, -closePercent))
result <- data.frame(create = NULL, close = NULL,
pipeOpened = NULL, amount = NULL)
rbind(result, select(df, -closePercent))
1:numrow(df)
rows(df)
length(df)
seq_along(df)
pipe
source('~/Google Drive/shiny-server2/cohort/helpers.R')
initCohortTable(pipe, inClose)
source('~/Google Drive/shiny-server2/cohort/helpers.R')
initCohortTable(pipe, inClose)
initCohortTable(pipe, inClose) %>%
dcast(create ~ close)
initCohortTable(pipe, inClose) %>%
dcast(create ~ close) %>%
View()
initCohortTable(pipe, inClose)
initCohortTable(pipe, inClose) %>%
dcast(create ~ close) %>%
datatable()
?dcast
initCohortTable(pipe, inClose)
initCohortTable(pipe, inClose) %>%
dcast(create ~ close, value.var = c(pipeOpened, amount)) %>%
datatable()
initCohortTable(pipe, inClose) %>%
dcast(create ~ close, value.var = c('pipeOpened', 'amount')) %>%
datatable()
initCohortTable(pipe, inClose) %>%
dcast(create ~ close, value.var = c('pipeOpened')) %>%
datatable()
initCohortTable(pipe, inClose) %>%
dcast(create ~ close, value.var = c('amount')) %>%
datatable()
?rename
source('~/Google Drive/shiny-server2/cohort/helpers.R')
source('~/Google Drive/shiny-server2/cohort/helpers.R')
initCohortTable(pipe, inClose) %>%
dcast(create ~ close, value.var = c('amount')) %>%
datatable()
initCohortTable(pipe, inClose) %>%
dcast(create ~ close, value.var = c('pipeClosed')) %>%
datatable()
source('~/Google Drive/shiny-server2/cohort/helpers.R')
initCohortTable(pipe, inClose) %>%
dcast(create ~ close, value.var = c('pipeClosed')) %>%
datatable()
initCohortTable(pipe, inClose)
cc <- data.frame()
cc
rbind(cc, data.frame(a = '1', b = 1))
copyKevinsCohortFormat <- function(pipeDF, closeDF) {
pipeOpenedTable <- initCohortTable(pipeDF, closeDF) %>%
dcast(create ~ close, value.var = 'pipeOpened')
pipeClosedTable <- initCohortTable(pipeDF, closeDF) %>%
dcast(create ~ close, value.var = 'pipeClosed')
closePercentTable <- initCohortTable(pipeDF, closeDF) %>%
dcast(create ~ close, value.var = 'closePercent')
completeCohort <- data.frame()
for (i in 1:nrow(pipeOpenedTable)) {
completeCohort <- rbind(completeCohort, pipeOpenedTable[i, ])
completeCohort <- rbind(completeCohort, pipeClosedTable[i, ])
completeCohort <- rbind(completeCohort, closePercentTable[i, ])
}
return(completeCohort)
}
copyKevinsCohortFormat(pipe, inClose) %>% View()
source('~/Google Drive/shiny-server2/cohort/helpers.R')
copyKevinsCohortFormat(pipe, inClose) %>% View()
?view
?View
a <- copyKevinsCohortFormat(pipe, inClose)
str(a)
format(a$create)
format(a$create, '%b %d')
format(a$create, '%b %y')
a$labels <- paste0(
format(a$create, '%b %y'),
c('Pipe Opened', 'Pipe Closed', 'Closed %')
)
str(a)
View(a)
source('~/Google Drive/shiny-server2/cohort/helpers.R')
a <- copyKevinsCohortFormat(pipe, inClose)
VIew(a)
View(a)
a %>% datatable()
source('~/Google Drive/shiny-server2/cohort/helpers.R')
source('~/Google Drive/shiny-server2/cohort/helpers.R')
a <- copyKevinsCohortFormat(pipe, inClose)
View(a)
source('~/Google Drive/shiny-server2/cohort/helpers.R')
write.csv(a, 'test.csv')
install.packages('xlsx')
library(xlsx)
wb <- createWorkbook()
cs1<- CellStyle(wb) + Font(wb, isItalic = T)
cs2 <- CellStyle(wb) + Font(wb, color = 'blue')
cs3 <- CellStyle(wb) + Font(wb, isBold = T) + Border()
addDataFrame(a, sheet1, startRow = 3, startColumn = 2,
colnamesStyle = cs3, rownamesStyle = cs1,
colStyle = list(`2` = cs2, `3` = cs2))
sheet1 <- createSheet(wb, sheetName = 'inboundCohort')
addDataFrame(a, sheet1, startRow = 3, startColumn = 2,
colnamesStyle = cs3, rownamesStyle = cs1,
colStyle = list(`2` = cs2, `3` = cs2))
saveWorkbook(wb, file = 'testWorkbook.xlsx')
rownames(a)
?colStyle
?addDataFrame
wb <- createWorkbook()
sheet1 <- createSheet(wb, sheetName = 'inboundCohort')
cs1<- CellStyle(wb) + Font(wb, isItalic = T)
cs2 <- CellStyle(wb) + Font(wb, color = 'blue')
cs3 <- CellStyle(wb) + Font(wb, isBold = T) + Border()
addDataFrame(a, sheet1, startRow = 3, startColumn = 2, row.names = F,
colnamesStyle = cs3,
colStyle = list(cs3))
saveWorkbook(wb, file = 'testWorkbook.xlsx')
saveWorkbook(wb, file = 'testWorkbook.xlsx')
wb <- createWorkbook()
sheet1 <- createSheet(wb, sheetName = 'inboundCohort')
cs1<- CellStyle(wb) + Font(wb, isItalic = T)
cs2 <- CellStyle(wb) + Font(wb, color = 'blue')
cs3 <- CellStyle(wb) + Font(wb, isBold = T) + Border()
addDataFrame(a, sheet1, startRow = 3, startColumn = 2, row.names = F,
colnamesStyle = cs3, colStyle = cs2)
saveWorkbook(wb, file = 'testWorkbook.xlsx')
source('~/Google Drive/shiny-server2/cohort/helpers.R')
runApp()
runApp()
runApp()
runApp()
runApp()
rm(list = ls())
